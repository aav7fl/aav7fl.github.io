<!doctype html>
<html amp lang="en">



  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,700" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Lora:400,700" rel="stylesheet" type="text/css"><meta charset="utf-8"><title>Microsoft Word Auto-Journal Macro for the Lazy</title><link rel="canonical" href="https://www.kyleniewiada.org/blog/2016/03/word-auto-journal-macro-for-lazy/"><meta property="og:url" content="https://www.kyleniewiada.org/blog/2016/03/word-auto-journal-macro-for-lazy/"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><!-- Chrome, Firefox OS and Opera --><meta name="theme-color" content="#3d256d"><!-- Windows Phone --><meta name="msapplication-navbutton-color" content="#3d256d"><!-- Begin Jekyll SEO tag v2.1.0 --><title>Microsoft Word Auto-Journal Macro for the Lazy - Kyle Niewiada’s Website</title><meta property="og:title" content="Microsoft Word Auto-Journal Macro for the Lazy"><meta name="description" content="My little corner of the Internet where I write about projects I’ve figured out"><meta property="og:description" content="My little corner of the Internet where I write about projects I’ve figured out"><meta property="og:site_name" content="Kyle Niewiada’s Website"><meta property="og:image" content="https://www.kyleniewiada.org/assets/img/2016/03/banner.png"><meta property="og:image:height" content="505"><meta property="og:image:width" content="964"><meta property="og:type" content="article"><meta property="article:published_time" content="2016-03-14T16:19:00-04:00"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@CrypticCitrus"><meta name="twitter:creator" content="@CrypticCitrus"><meta property="fb:app_id" content="137961485759"><script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Microsoft Word Auto-Journal Macro for the Lazy",
"author": {"@type": "Person",
"name": "Kyle Niewiada"},
"image": {"@type": "ImageObject",
"url": "https://www.kyleniewiada.org/assets/img/2016/03/banner.png",
"height": 505,
"width": 964},
"datePublished": "2016-03-14T16:19:00-04:00",
"dateModified": "2016-03-14T16:19:00-04:00",
"description": "My little corner of the Internet where I write about projects I’ve figured out",
"publisher": {"@type": "Organization",
"name": "Kyle Niewiada",
"logo": {"@type": "ImageObject",
"url": "https://www.kyleniewiada.org/assets/logo.jpg"}},
"mainEntityOfPage": {"@type": "WebPage",
"@id": "https://www.kyleniewiada.org/amp/blog/2016/03/word-auto-journal-macro-for-lazy/"},
"url": "https://www.kyleniewiada.org/amp/blog/2016/03/word-auto-journal-macro-for-lazy/"}</script><!-- End Jekyll SEO tag --><style amp-custom>
  
  body,p,li,ul{font-size:16px;line-height:1.58;color:#111;font-family:"Open Sans",Helvetica,Arial,sans-serif}p code,p pre{background-color:#fff;color:#9e023b;display:inline-block;border:1px solid #d3d3d3;border-radius:.2em;padding:0 .3em}.pageTitle{text-align:left;font-size:200%;line-height:1.2;font-weight:400}@media (min-width: 600px){.pageTitle{font-size:250%}}@media (min-width: 1000px){.pageTitle{font-size:300%}}.meta{color:gray;font-family:"Open Sans",Helvetica,Arial,sans-serif;font-weight:300;font-size:120%}@media (min-width: 600px){.meta{font-size:130%}}@media (min-width: 1000px){.meta{font-size:140%}}.meta.center{text-align:center;display:block}.titlemeta{overflow:auto;color:#696969;font-family:"Open Sans",Helvetica,Arial,sans-serif;font-size:100%}.titlemeta .meta-left{float:left}.titlemeta .meta-right{float:right}h1,.h1,h2,.h2,h3,.h3,h4,.h4,h5,.h5,h6,.h6{margin:0 0 .5rem;font-family:"Open Sans",Helvetica,Arial,sans-serif;font-weight:600}::-moz-selection{background:#3d256d;color:white}::selection{background:#3d256d;color:white}a{color:#3d256d}a:hover{color:#1d1234}.line-separator{height:1px;background:gray;margin-top:16px;margin-bottom:16px}.container:after{content:" ";display:block;clear:both}.post,.container{max-width:700px;margin-right:auto;margin-left:auto;padding:0 16px}.post img,.container img{display:block;margin-left:auto;margin-right:auto}img,video,audio,iframe,object,amp-video{max-width:100%}.noList{list-style:none;padding-left:0;margin-left:0}.pagination .next{float:left}.pagination .previous{float:right}.posts li{margin-bottom:4rem;position:relative}.posts li:before{content:"";position:absolute;bottom:-2rem;left:0;background:#e6e6e6;height:2px;width:60px}.posts li a{text-decoration:none}.posts li a:hover{text-decoration:underline}.posts li .date{color:gray;font-family:"Open Sans",Helvetica,Arial,sans-serif;font-weight:300;font-size:.8em}.header-amp{background:#262626;margin-bottom:16px;padding:16px;text-align:center;font-size:1.4em;font-weight:400}.header-amp a,.header-amp a:hover{color:#fff;text-decoration:none;overflow:visible}


  

  
  .footer{text-align:center;padding:2rem 0}.footer .container{border-top:4px solid #d9d9d9;padding-top:.5em}.footer ul{text-align:center}.post img+em,.post amp-img+em,.post video+em{text-align:center;font-size:.9em;font-style:italic;color:#5e5e5e;display:block}.post img+p,.post amp-img+p{margin-bottom:2rem}blockquote{background:#ffa;border-left:10px solid #dc0;margin:1.5em 10px;padding:0.5em 10px}.postNav{border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6;overflow:hidden}.postNav .prev,.postNav .next{display:block;width:100%;height:5rem;overflow:hidden;position:relative;font-family:"Open Sans",Helvetica,Arial,sans-serif;font-weight:800;font-size:.9em;text-align:center}.postNav .prev img,.postNav .next img{display:block;position:absolute;top:50%;-webkit-transform:translateY(-50%);-webkit-filter:brightness(40%);-ms-transform:translateY(-50%);transform:translateY(-50%);filter:brightness(40%);left:0;width:100%;height:auto}.postNav .prev span,.postNav .next span{z-index:1;position:relative;padding:.5rem;position:absolute;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);line-height:1.4}.postNav .prev.image,.postNav .next.image{text-decoration:none;color:white;text-shadow:1px 1px 8px rgba(0,0,0,0.8);position:relative}.postNav .prev:hover.image,.postNav .next:hover.image{opacity:.8}.postNav .prev span{left:0}.postNav .next span{right:0}@media (min-width: 600px){.postNav .prev,.postNav .next{width:50%}.postNav .prev{float:left;text-align:left}.postNav .next{text-align:right;float:right}}.button,.button-secondary,.button-tertiary,.button__outline{background-color:#3d256d;display:inline-block;position:relative;font-family:"Open Sans",Helvetica,Arial,sans-serif;text-decoration:none;color:#fff;font-size:1em;line-height:1.2em;font-weight:normal;padding:.5em 1.5em;border:0;border-radius:4px;cursor:pointer;margin-bottom:.5em}.button:hover,.button-secondary:hover,.button-tertiary:hover,.button__outline:hover,.button:focus,.button-secondary:focus,.button-tertiary:focus,.button__outline:focus{color:#fff;text-decoration:none;background-color:#281847}.button:active,.button-secondary:active,.button-tertiary:active,.button__outline:active{top:1px}.button-secondary{background-color:#1b3665}.button-secondary:hover{background-color:#10203d}.button-tertiary{background-color:#33446f}.button-tertiary:hover{background-color:#232f4c}.button__outline{background-color:transparent;border:3px solid #3d256d;color:#3d256d}.button__outline:hover{background-color:#3d256d;color:#fff}.highlight{background:#d3d3d3;overflow-y:hidden;padding:16px}.highlight .c{color:#999988;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#999988;font-style:italic}.highlight .cp{color:#999999;font-weight:bold}.highlight .c1{color:#999988;font-style:italic}.highlight .cs{color:#999999;font-weight:bold;font-style:italic}.highlight .gd{color:#000000;background-color:#fdd}.highlight .gd .x{color:#000000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000000;background-color:#dfd}.highlight .gi .x{color:#000000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#445588;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:teal}.highlight .nb{color:#0086B3}.highlight .nc{color:#445588;font-weight:bold}.highlight .no{color:teal}.highlight .ni{color:purple}.highlight .ne{color:#990000;font-weight:bold}.highlight .nf{color:#990000;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}

  </style><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>

  <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async src="https://cdn.ampproject.org/v0.js"></script>

<body>
<amp-analytics type="googleanalytics">
  <script type="application/json">
  {
    "vars": {
      "account": "UA-37567352-1"
    },
    "triggers": {
      "trackPageview": {
        "on": "visible",
        "request": "pageview"
      }
    }
  }
  </script>
</amp-analytics>



<!-- start header -->
<h1 class="header-amp">
  <a href="/">Kyle Niewiada</a>
</h1>
<!-- end header -->


<div class="post">
  <div class="post_info">
    <h1 class="pageTitle">Microsoft Word Auto-Journal Macro for the Lazy</h1>

    <h2 class="meta">Kyle Niewiada

    <h3 class="meta">March 14, 2016 | 5 Minute Read</h3>

    
    <div class="featuredImage">
      <amp-img src="/assets/img/2016/03/banner.png" alt="Microsoft Word output for auto journal macro" width="964" height="505" layout="responsive"><noscript><img src="/assets/img/2016/03/banner.png" alt="Microsoft Word output for auto journal macro" width="964" height="505"></noscript></amp-img>
</div>
    

    <div class="line-separator"></div>

  </h2>
</div>

  <p>A few months back I was given the requirement for a project to keep some kind of journal logging the number of hours I spent on a task along with a short description. Because the project was deeply integrated with Microsoft products and services, I decided that it would be best to write such a journal with Microsoft Word.</p>

<p>As is the motivation for many projects/scripts of mine, I wanted to automate the process as much as possible such that I never had to think about it again [anytime soon]. This was shortly after I had <a href="/blog/2015/12/making-a-book-from-facebook-messages/">concluded work on a previous project</a> that involved using Microsoft Word with macro scripts. I was ready to learn more about its advanced features. I wanted an automatic running total because I would often forget to recalculate my grand total after each entry. There were probably other solutions that were better suited for this, but I really wanted to see how useful Microsoft Word macros (I know the evil stigma associated with macros) could be to me.</p>

<h4 id="goals">Goals:</h4>

<ol>
<li>Automatically insert a new blank entry for today with the cursor ready to write a description</li>
  <li>The ability to total hours for all entries without the user remembering</li>
  <li>Automatically update total hours at top of document</li>
</ol>
<h4 id="results">Results:</h4>

<p>I created a Microsoft Word macro enabled document that when opened will:</p>

<ol>
<li>Automatically remove empty paragraphs that Microsoft Word <em>loves</em> to place at the end of your document</li>
  <li>Add skeleton text containing today’s date, start, end, and total time</li>
  <li>Add a paragraph labeled “Description:”</li>
  <li>Calculate total hours on exit without user needing to remember</li>
  <li>Automatically add skeleton entry on document open</li>
</ol>
<h3 id="what-it-does">What it does</h3>

<p>I have provided an example document below. It includes a text-button to add the total number of hours for each entry and another text-button to add new journal entries.</p>

<p>The macro calculates the total number of hours entered by searching for the ‘Total [*]’ string. When it matches, it will add the number found between ‘[]’ to a running total until the entire document has been searched. It will then return the total. The example document shows this total at the top. It is not foolproof. It can be easily defeated if someone decides to include the ‘Total [*]’ string inside their journal entry, or if one wants to overflow the numbers. But it works for me without any major issues (including the null value case), and that is what mattered.</p>

<p>The macro adds a new journal entry to the end of the text by searching for the end of the document, removing any extra paragraphs at the end of the document, and then adding in the pre-scripted skeleton structure for a new journal entry with the date of today. During planning, I could have gone above and beyond and calculated the total hours between the start time and end time of a task/added it to the ‘Total []’ field, but I decided to draw the line there. The amount of work I was putting in for something that would take no time to accomplish would not be paying off.</p>

<p>When the document is closed, the macro will run and add up the total number of hours from the listed entries automatically. A save dialog will then pop up and the user may choose to save or discard changes.</p>

<h3 id="source-code-and-example-document">Source code and example document</h3>

<p><a href="/assets/files/2016/03/JournalExample.docm">Microsoft Word Auto-Journal example document</a></p>

<p>Above is a link to the macro enabled Microsoft Word document example. Below is the source code for the macro. Most of it is pieced together from other examples online accomplishing similar tasks. I spent most of my time looking at different resources for visual basic techniques and have mentioned those sources in nearby comments for pieces of code where available.</p>

<noscript><pre>Sub AutoOpen()

    Call autoText
    
End Sub

'Generate form fill text for document on call
Sub autoText()
    
    'remove the empty paragraph that word likes to add to the end of the document on open.
    Call removeEmptyPara
    Selection.EndKey Unit:=wdStory
    Selection.TypeParagraph
    Selection.InsertDateTime DateTimeFormat:="MMMM dd, yyyy", _
    InsertAsField:=False
    Selection.TypeText vbTab &amp; "Start [] End [] Total []"
    Selection.EndKey Unit:=wdStory
    Selection.TypeParagraph
    Selection.TypeText "Description: "

End Sub

'Removes empty paragraphs located at the end of the document
Sub removeEmptyPara()
    'http://www.extendoffice.com/documents/word/647-word-remove-empty-paragraphs.html
    Selection.Find.ClearFormattin
    Selection.Find.Replacement.ClearFormatting
    With Selection.Find
        .Text = "^p^p"
        .Replacement.Text = ""
        .Forward = True
        .Wrap = wdFindContinue
        .Format = False
        .MatchCase = False
        .MatchWholeWord = False
        .MatchByte = False
        .MatchAllWordForms = False
        .MatchSoundsLike = False
        .MatchWildcards = False
        .MatchFuzzy = False
    End With
    Selection.Find.Execute Replace:=wdReplaceAll

End Sub

Sub AutoClose()

    Call findTotal

End Sub

Sub findTotal()

    'based on http://stackoverflow.com/questions/6425595/word-vba-how-to-select-text-between-two-substrings-and-assign-to-variable
    
    Dim firstTerm As String
    Dim secondTerm As String
    Dim myRange As Range
    Dim documentText As String

    Dim startPos As Long 'Stores the starting position of firstTerm
    Dim stopPos As Long 'Stores the starting position of secondTerm based on first term's location
    Dim nextPosition As Long 'The next position to search for the firstTerm
    Dim total As Double
    
    total = 0
    nextPosition = 1

    firstTerm = "Total ["
    secondTerm = "]"

    'Get all the document text and store it in a variable.
    Set myRange = ActiveDocument.Range
    'Maximum limit of a string is 2 billion characters.
    'So, hopefully your document is not bigger than that.  However, expect declining performance based on how big doucment is
    documentText = myRange.Text

    'Loop documentText till you can't find any more matching "terms"
    Do Until nextPosition = 0
        startPos = InStr(nextPosition, documentText, firstTerm, vbTextCompare)
        stopPos = InStr(startPos, documentText, secondTerm, vbTextCompare)

        'prevents empty brackets from crashing macro
        If stopPos - startPos &lt;&gt; Len(firstTerm) Then
            'Debug.Print Mid$(documentText, startPos + Len(firstTerm), stopPos - startPos - Len(firstTerm))
            total = total + Mid$(documentText, startPos + Len(firstTerm), stopPos - startPos - Len(firstTerm))
        End If
        nextPosition = InStr(stopPos, documentText, firstTerm, vbTextCompare)
    Loop
    
    Debug.Print "Total = "; total
    ActiveDocument.Variables("total").Delete
    ActiveDocument.Variables.Add Name:="total", Value:=total
    'MsgBox "I'm done"
    Call UpdateAll

End Sub

Sub UpdateAll()
    'Based on unknown source.
    Dim oStory As Range
    For Each oStory In ActiveDocument.StoryRanges
        oStory.Fields.Update
        If oStory.StoryType &lt;&gt; wdMainTextStory Then
            While Not (oStory.NextStoryRange Is Nothing)
                Set oStory = oStory.NextStoryRange
                oStory.Fields.Update
            Wend
        End If
    Next oStory
    Set oStory = Nothing
End Sub</pre></noscript>
<script src="https://gist.github.com/aav7fl/7df0051c6fa9fd8a42bb.js"> </script>
</div>

<a href="/blog/2016/03/word-auto-journal-macro-for-lazy/" class="meta center">Comments are available on the full webpage.</a>


<!-- start footer -->
  <div class="footer">
    <div class="container">
      <span class="meta">
        <span> | </span>

  
    <a href="https://www.linkedin.com/in/kyleniewiada/">LinkedIn</a>
  
    <span> | </span>

  
    <a href="https://github.com/aav7fl">GitHub</a>
  
    <span> | </span>

  
    <a href="https://twitter.com/CrypticCitrus">Twitter</a>
  
    <span> | </span>

  
    <a href="https://www.youtube.com/user/KyleNiewiada">YouTube</a>
  
    <span> | </span>

  
    <a href="https://kyleniewiada.bandcamp.com/" rel="nofollow">BandCamp</a>
  
    <span> | </span>


      </span>
    </div>
  </div>
<!-- end footer -->

</body>

</html>
